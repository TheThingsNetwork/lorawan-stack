<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Configuration - The Things Stack for LoRaWAN Documentation</title>
<meta name="description" content="Documentation for The Things Stack for LoRaWAN">
<meta name="generator" content="Hugo 0.58.1" />
<link href="https://thethingsstack.io/v3.2.1index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://thethingsstack.io/v3.2.1/guides/getting-started/configuration/">
<link rel="stylesheet" href="https://thethingsstack.io/v3.2.1/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://thethingsstack.io/v3.2.1/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://thethingsstack.io/v3.2.1/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://thethingsstack.io/v3.2.1/js/jquery.backtothetop/jquery.backtothetop.min.js"></script></head>
<body>
<div class="container"><header>
<h1>The Things Stack for LoRaWAN Documentation</h1>

 <span class="version">Version v3.2.1</span>
<a href="https://github.com/TheThingsNetwork/lorawan-stack" class="github"><i class="fab fa-github"></i></a>
<p class="description">Documentation for The Things Stack for LoRaWAN</p>

</header>
<div class="menu">
<nav>
<ul>
<li><a href="/v3.2.1/guides/getting-started/">Getting Started</a></li>
<li><a href="/v3.2.1/guides/">Guides</a></li>
<li><a href="/v3.2.1/concepts/">Concepts</a></li>
<li><a href="/v3.2.1/components/">Components</a></li>
<li><a href="/v3.2.1/reference/">Reference</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Configuration</h1>

<p>The Things Stack can be started for development without passing any configuration. However, there are a number of things you need to configure for a production deployment. In this guide we&rsquo;ll set environment variables in the <code>docker-compose.yml</code> file to configure The Things Stack as a private deployment on <code>thethings.example.com</code>.</p>

<h2 id="databases">Databases</h2>

<p>We need to configure an SQL database, in this guide we&rsquo;ll use a single instance of <a href="https://www.cockroachlabs.com/">CockroachDB</a>. Make sure to find a recent tag of the <a href="https://hub.docker.com/r/cockroachdb/cockroach/tags">cockroachdb/cockroach image on Docker Hub</a> and update it in the <code>docker-compose.yml</code> file. Make sure that the <code>volumes</code> are set up correctly so that the database is persisted on your server&rsquo;s disk.</p>

<p>The simplest configuration for CockroachDB will look like this:</p>

<pre><code class="language-yml">cockroach:
  image: cockroachdb/cockroach:&lt;the tag&gt;
  command: start --http-port 26256 --insecure
  restart: unless-stopped
  volumes:
    - ./data/cockroach:/cockroach/cockroach-data
</code></pre>

<p>Read the CockroachDB documentation for setting up a highly available cluster.</p>

<p>We also need to configure <a href="https://redis.io/">Redis</a>, in this guide we&rsquo;ll use a single instance of Redis. Just as with the SQL database, find a recent tag of the <a href="https://hub.docker.com/_/redis?tab=tags">redis image on Docker Hub</a> and update it in the <code>docker-compose.yml</code> file. Again, make sure that the <code>volumes</code> are set up correctly so that the datastore is persisted on your server&rsquo;s disk.</p>

<p>The simplest configuration for Redis will look like this:</p>

<pre><code class="language-yml">redis:
  image: redis:&lt;the tag&gt;
  command: redis-server --appendonly yes
  restart: unless-stopped
  volumes:
    - ./data/redis:/data
</code></pre>

<p>Read the Redis documentation for setting up a highly available cluster.</p>

<h2 id="the-things-stack">The Things Stack</h2>

<p>Before we go into the details of The Things Stack&rsquo;s configuration, we&rsquo;ll take a look at the basics. Below you see part the configuration of the <code>stack</code> service in the <code>docker-compose.yml</code> file. As with the databases, you need to find a recent tag of the <a href="https://hub.docker.com/r/thethingsnetwork/lorawan-stack/tags">thethingsnetwork/lorawan-stack image on Docker Hub</a> and update the <code>docker-compose.yml</code> file with that. We tell Docker Compose to start the container with <code>ttn-lw-stack start</code>, we indicate that it depends on CockroachDB and Redis, and we configure a volume for storing blobs (such as profile pictures).</p>

<p>The <code>ports</code> section exposes The Things Stack&rsquo;s ports to the world. Port <code>80</code> and <code>443</code> are mapped to the internal HTTP and HTTPS ports. The other ports have a direct mapping. If you don&rsquo;t need support for gateways and applications that don&rsquo;t support TLS, you can remove ports starting with <code>188</code>.</p>

<pre><code class="language-yml">stack:
  image: thethingsnetwork/lorawan-stack:&lt;the tag&gt;
  entrypoint: ttn-lw-stack
  command: start
  restart: unless-stopped
  depends_on:
    - cockroach
    - redis
  volumes:
    - ./acme:/var/lib/acme
    - ./data/blob:/srv/ttn-lorawan/public/blob
  ports:
    - &quot;80:1885&quot;
    - &quot;443:8885&quot;
    - &quot;1882:1882&quot;
    - &quot;8882:8882&quot;
    - &quot;1883:1883&quot;
    - &quot;8883:8883&quot;
    - &quot;1884:1884&quot;
    - &quot;8884:8884&quot;
    - &quot;1887:1887&quot;
    - &quot;8887:8887&quot;
    - &quot;1700:1700/udp&quot;
</code></pre>

<p>Next, we&rsquo;ll have a look at the configuration options for your private deployment. These options are set in the <code>environment</code> section of the <code>stack</code> service in <code>docker-compose.yml</code>.</p>

<p>First we&rsquo;ll make sure that The Things Stack uses the correct databases.</p>

<pre><code>TTN_LW_IS_DATABASE_URI=postgres://root@cockroach:26257/ttn_lorawan?sslmode=disable
TTN_LW_REDIS_ADDRESS=redis:6379
</code></pre>

<p>Then we&rsquo;ll configure TLS with Let&rsquo;s Encrypt. Since we&rsquo;re deploying The Things Stack on <code>thethings.example.com</code>, we configure it to only request certificates for that host, and to also use it as the default host.</p>

<pre><code>TTN_LW_TLS_ACME_ENABLE=true
TTN_LW_TLS_ACME_DIR=/var/lib/acme
TTN_LW_TLS_ACME_EMAIL=your@email.com
TTN_LW_TLS_ACME_HOSTS=thethings.example.com
TTN_LW_TLS_ACME_DEFAULT_HOST=thethings.example.com
</code></pre>

<p>Next, we&rsquo;ll configure the HTTP server with keys for encrypting and verifying cookies, and with passwords for endpoints that you may want to keep for internal use.</p>

<pre><code>TTN_LW_HTTP_COOKIE_HASH_KEY=generate 64 bytes (openssl rand -hex 64)
TTN_LW_HTTP_COOKIE_BLOCK_KEY=generate 32 bytes (openssl rand -hex 32)
TTN_LW_HTTP_METRICS_PASSWORD=choose a password
TTN_LW_HTTP_PPROF_PASSWORD=choose a password
</code></pre>

<p>The Things Stack sends emails to users, so we need to configure how those are sent.</p>

<pre><code>TTN_LW_IS_EMAIL_SENDER_NAME=The Things Stack
TTN_LW_IS_EMAIL_SENDER_ADDRESS=noreply@thethings.example.com
TTN_LW_IS_EMAIL_NETWORK_CONSOLE_URL=https://thethings.example.com/console
TTN_LW_IS_EMAIL_NETWORK_IDENTITY_SERVER_URL=https://thethings.example.com/oauth
</code></pre>

<p>You can either use Sendgrid or an SMTP server. If you don&rsquo;t set up an email provider, The Things Stack will print emails to the server log.</p>

<pre><code>TTN_LW_IS_EMAIL_PROVIDER=sendgrid
TTN_LW_IS_EMAIL_SENDGRID_API_KEY=enter Sendgrid API key
</code></pre>

<p>or</p>

<pre><code>TTN_LW_IS_EMAIL_PROVIDER=smtp
TTN_LW_IS_EMAIL_SMTP_ADDRESS=enter mail server address
TTN_LW_IS_EMAIL_SMTP_USERNAME=enter username
TTN_LW_IS_EMAIL_SMTP_PASSWORD=enter password
</code></pre>

<p>Finally, we need to configure the Web UI to use <code>thethings.example.com</code>.</p>

<pre><code>TTN_LW_IS_OAUTH_UI_CANONICAL_URL=https://thethings.example.com/oauth
TTN_LW_IS_OAUTH_UI_IS_BASE_URL=https://thethings.example.com/api/v3

TTN_LW_CONSOLE_OAUTH_AUTHORIZE_URL=https://thethings.example.com/oauth/authorize
TTN_LW_CONSOLE_OAUTH_TOKEN_URL=https://thethings.example.com/oauth/token

TTN_LW_CONSOLE_UI_CANONICAL_URL=https://thethings.example.com/console
TTN_LW_CONSOLE_UI_AS_BASE_URL=https://thethings.example.com/api/v3
TTN_LW_CONSOLE_UI_GS_BASE_URL=https://thethings.example.com/api/v3
TTN_LW_CONSOLE_UI_IS_BASE_URL=https://thethings.example.com/api/v3
TTN_LW_CONSOLE_UI_JS_BASE_URL=https://thethings.example.com/api/v3
TTN_LW_CONSOLE_UI_NS_BASE_URL=https://thethings.example.com/api/v3

TTN_LW_CONSOLE_OAUTH_CLIENT_ID=console
TTN_LW_CONSOLE_OAUTH_CLIENT_SECRET=choose or generate a secret
</code></pre>

<p>You will need the <code>TTN_LW_CONSOLE_OAUTH_CLIENT_SECRET</code> again in a later step.</p>

<h2 id="command-line-interface">Command-line interface</h2>

<p>The command-line interface is configured to connect to <code>localhost</code> by default. In order to make it connect to <code>thethings.example.com</code>, you need to configure it with a configuration file. The recommended way to configure the CLI is with a <code>.ttn-lw-cli.yml</code> in your <code>$XDG_CONFIG_HOME</code> or <code>$HOME</code> directory. You can also put the config file in a different location, and pass it to the CLI as <code>-c path/to/config.yml</code>. Your config file should look like this:</p>

<pre><code class="language-yml">oauth-server-address: https://thethings.example.com/oauth

identity-server-grpc-address: thethings.example.com:8884
gateway-server-grpc-address: thethings.example.com:8884
network-server-grpc-address: thethings.example.com:8884
application-server-grpc-address: thethings.example.com:8884
join-server-grpc-address: thethings.example.com:8884
device-template-converter-grpc-address: thethings.example.com:8884
</code></pre>
<div class="edit-meta">
Last updated on 26 Aug 2019


<br><a href="https://github.com/TheThingsNetwork/lorawan-stack/edit/master/doc/content/guides/getting-started/configuration.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="/v3.2.1/guides/getting-started/webhooks/" title="HTTP Webhooks"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - HTTP Webhooks</a>
<a class="nav nav-next" href="/v3.2.1/guides/getting-started/console/" title="Console">Next - Console <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">
<nav>
<ul>
<li class=""><a href="https://thethingsstack.io/v3.2.1">Home</a></li>

<li class="parent"><a href="/v3.2.1/guides/">Guides</a>
<ul class="sub-menu">

<li class="parent"><a href="/v3.2.1/guides/getting-started/">Getting Started</a>
<ul class="sub-menu">
<li class=""><a href="/v3.2.1/guides/getting-started/installation/">Installation</a></li>
<li class=""><a href="/v3.2.1/guides/getting-started/certificates/">Certificates</a></li>
<li class="active"><a href="/v3.2.1/guides/getting-started/configuration/">Configuration</a></li>
<li class=""><a href="/v3.2.1/guides/getting-started/running-the-stack/">Running The Things Stack</a></li>

<li class=""><a href="/v3.2.1/guides/getting-started/console/">Console</a>
</li>

<li class=""><a href="/v3.2.1/guides/getting-started/cli/">Command-line Interface</a>
</li>

<li class=""><a href="/v3.2.1/guides/getting-started/mqtt/">MQTT Server</a>
</li>

<li class=""><a href="/v3.2.1/guides/getting-started/webhooks/">HTTP Webhooks</a>
</li>
</ul>
  
</li>

<li class=""><a href="/v3.2.1/guides/events/">Working with Events</a>
</li>

<li class=""><a href="/v3.2.1/guides/downlink-queue-ops/">Downlink Queue Operations</a>
</li>

<li class=""><a href="/v3.2.1/guides/class-c-multicast/">Class C and Multicast</a>
</li>
</ul>
  
</li>

<li class=""><a href="/v3.2.1/concepts/">Concepts</a>
<ul class="">
<li class=""><a href="/v3.2.1/concepts/end-device-templates/">End Device Templates</a></li>
<li class=""><a href="/v3.2.1/concepts/email-templates/">Email Templates</a></li>
</ul>
  
</li>

<li class=""><a href="/v3.2.1/components/">Components</a>
</li>

<li class=""><a href="/v3.2.1/reference/">Reference</a>
<ul class="">

<li class=""><a href="/v3.2.1/reference/end-device-templates/">End Device Templates</a>
<ul class="">
<li class=""><a href="/v3.2.1/reference/end-device-templates/creating/">Creating Templates</a></li>
<li class=""><a href="/v3.2.1/reference/end-device-templates/converting/">Converting Templates</a></li>
<li class=""><a href="/v3.2.1/reference/end-device-templates/executing/">Executing Templates</a></li>
<li class=""><a href="/v3.2.1/reference/end-device-templates/mapping/">Mapping Templates</a></li>
<li class=""><a href="/v3.2.1/reference/end-device-templates/assigning-euis/">Assigning EUIs</a></li>
</ul>
  
</li>

<li class=""><a href="/v3.2.1/reference/email-templates/">Email Templates</a>
<ul class="">
<li class=""><a href="/v3.2.1/reference/email-templates/available/">Available Templates</a></li>
<li class=""><a href="/v3.2.1/reference/email-templates/overriding/">Overriding Templates</a></li>
</ul>
  
</li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
